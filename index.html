<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gallery Upload Auto-Reply Admin</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; display: flex; justify-content: center; }
        .admin-box { width: 500px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #517da2; margin-bottom: 20px; }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; }
        .hidden { display: none; }
        .preview-area { margin-top: 10px; text-align: center; }
        #file-preview { max-width: 100%; max-height: 150px; border-radius: 8px; display: none; }
        button { width: 100%; padding: 12px; background: #517da2; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; font-weight: bold; }
        .list-item { background: #f9f9f9; padding: 10px; margin-top: 10px; border-radius: 8px; border-left: 5px solid #517da2; position: relative; font-size: 13px; }
        .del-btn { position: absolute; right: 10px; top: 10px; color: red; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="admin-box">
    <h2>Bot Auto-Reply Manager</h2>
    
    <label>User Keyword (Sawal):</label>
    <input type="text" id="trigger" placeholder="e.g. video, hello">

    <label>Reply Type:</label>
    <select id="reply-type" onchange="toggleFields()">
        <option value="text">Plain Text</option>
        <option value="image">Image (Gallery से)</option>
        <option value="video">Video (Gallery से)</option>
        <option value="link">Button / Link</option>
    </select>

    <div id="text-field">
        <label>Reply Message:</label>
        <input type="text" id="response-text" placeholder="Enter message...">
    </div>

    <div id="gallery-field" class="hidden">
        <label id="file-label">Select File from Gallery:</label>
        <input type="file" id="file-input" accept="image/*,video/*" onchange="previewFile()">
        <div class="preview-area">
            <p id="loading-text" class="hidden">Converting file... Please wait.</p>
            <img id="img-preview" style="max-width:100%; border-radius:8px; display:none;">
            <video id="vid-preview" style="max-width:100%; border-radius:8px; display:none;" controls></video>
        </div>
    </div>

    <div id="link-field" class="hidden">
        <label>Button Label:</label>
        <input type="text" id="btn-label" placeholder="Click Here">
        <label>Target URL:</label>
        <input type="text" id="target-url" placeholder="https://google.com">
    </div>

    <button id="save-btn" onclick="saveAdvancedReply()">Save Auto-Reply</button>

    <div id="reply-list"></div>
</div>

<script>
    let base64File = ""; // File data store karne ke liye

    function toggleFields() {
        const type = document.getElementById('reply-type').value;
        document.getElementById('text-field').className = (type === 'text' || type === 'link') ? '' : 'hidden';
        document.getElementById('gallery-field').className = (type === 'image' || type === 'video') ? '' : 'hidden';
        document.getElementById('link-field').className = (type === 'link') ? '' : 'hidden';
        
        // Reset previews
        document.getElementById('img-preview').style.display = 'none';
        document.getElementById('vid-preview').style.display = 'none';
        base64File = "";
    }

    // Gallery se file select karke Base64 banana
    function previewFile() {
        const file = document.getElementById('file-input').files[0];
        const reader = new FileReader();
        const type = document.getElementById('reply-type').value;

        if (file) {
            document.getElementById('loading-text').classList.remove('hidden');
            reader.readAsDataURL(file);
            reader.onload = function () {
                base64File = reader.result;
                document.getElementById('loading-text').classList.add('hidden');
                
                if (type === 'image') {
                    const img = document.getElementById('img-preview');
                    img.src = base64File;
                    img.style.display = 'block';
                } else if (type === 'video') {
                    const vid = document.getElementById('vid-preview');
                    vid.src = base64File;
                    vid.style.display = 'block';
                }
            };
        }
    }

    function saveAdvancedReply() {
        const trigger = document.getElementById('trigger').value.toLowerCase().trim();
        const type = document.getElementById('reply-type').value;
        
        if(!trigger) return alert("Trigger word likhen!");

        let data = { type: type };

        if(type === 'text') {
            data.val = document.getElementById('response-text').value;
        } else if(type === 'image' || type === 'video') {
            if(!base64File) return alert("Pehle Gallery se file select karein!");
            data.val = base64File; // Base64 data save hoga
        } else if(type === 'link') {
            data.val = document.getElementById('response-text').value;
            data.btnLabel = document.getElementById('btn-label').value;
            data.btnUrl = document.getElementById('target-url').value;
        }

        try {
            let replies = JSON.parse(localStorage.getItem('adv_replies')) || {};
            replies[trigger] = data;
            localStorage.setItem('adv_replies', JSON.stringify(replies));
            alert("Saved Successfully!");
            location.reload();
        } catch (e) {
            alert("File size bahut bada hai! Chhota video try karein (Max 2-4MB).");
        }
    }

    function showReplies() {
        const list = document.getElementById('reply-list');
        const replies = JSON.parse(localStorage.getItem('adv_replies')) || {};
        list.innerHTML = '<h3 style="margin-top:20px">Current Rules:</h3>';
        for(let key in replies) {
            list.innerHTML += `<div class="list-item">
                <b>User says:</b> ${key} | <b>Bot sends:</b> ${replies[key].type}
                <span class="del-btn" onclick="deleteReply('${key}')">✖</span>
            </div>`;
        }
    }

    function deleteReply(key) {
        let replies = JSON.parse(localStorage.getItem('adv_replies'));
        delete replies[key];
        localStorage.setItem('adv_replies', JSON.stringify(replies));
        location.reload();
    }
    showReplies();
</script>
</body>
</html>
